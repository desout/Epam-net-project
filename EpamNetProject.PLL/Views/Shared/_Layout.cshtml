@using EpamNetProject.PLL.Statics
@using Resources
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epam training application</title>
    @Styles.Render("~/wwwroot/css/index.css")
    @Scripts.Render("~/bundles/modernizr")
</head>
<body>
<div class="navbar">
    <div class="navbar__appName">
        @Html.ActionLink(Resource.ApplicationName, "Index", "Home", new {area = ""}, new {@class = "navbar__brand"})
    </div>
    <div class="navbar__basket">
     <p> @Resource.MAIN_BASKETTIME</p> <p class="navbar__basket--time"></p>
    </div>
    <ul class="navbar__navigation">
        <li>@Html.Action("Basket","Account")</li>
        @if (!User.Identity.IsAuthenticated)
        {
            <li>@Html.ActionLink(Resource.MAIN_LOGIN, "Login", "Account")</li>
            <li>@Html.ActionLink(Resource.MAIN_REGISTER, "Register", "Account")</li>
        }
        else
        {
            <li>@Html.ActionLink(Resource.MAIN_PROFILE, "Profile", "Account")</li>
            <li>@Html.ActionLink(Resource.MAIN_LOGOUT, "Logout", "Account")</li>
            if (Context.User.IsInRole("Manager") || Context.User.IsInRole("Admin"))
            {
                <li>@Html.ActionLink(Resource.MAIN_EDITEVENTS, "EditEvents", "Manager")</li>
            }
        }
        <li>@Html.ActionLink(Resource.MAIN_EVENTS, "Index", "Events")</li>
        <li>
            @using (Html.BeginForm("ChangeCulture", "Home", FormMethod.Post))
            {
                @Html.DropDownList("newCulture", new SelectList(StaticData.Languages, "Code", "Description", Culture))
            }
        </li>
    </ul>
</div>
<main>
    <div class="container">
        <div class="body-content">
            @RenderBody()
        </div>
    </div>
</main>
<footer>
    <p>&copy; @DateTime.Now.2019 - Epam training application</p>
</footer>
@Scripts.Render("~/bundles/jquery")
@RenderSection("scripts", false)
<script >
    $('#newCulture').change(function() {
     $(this).closest('form').submit();
    })
</script>
@Scripts.Render("~/bundles/jqueryval")
@Styles.Render("~/Content/themes/base/css")
@Scripts.Render("~/bundles/jqueryui")
@Scripts.Render("~/bundles/jquery.datetimepicker")
<script>
var interval = null;
function checkCookie(){
	var reserveDate = document.cookie.split(/reserveDate=/)[1];
    if(reserveDate) {
        var el = $('.navbar__basket--time');
        var now = new Date();
        var delay = now - new Date(parseInt(reserveDate)) ;
        var diffMins = ((delay % 86400000) % 3600000) / 60000;
        var timeMins = 15-diffMins;
        var timeSec = Math.floor((timeMins - Math.floor(timeMins))* 60);
        timeMins = Math.floor(timeMins);
        el.text(timeMins + ':' + timeSec);
        $('.navbar__basket').show();
        if(!interval){
            interval = setInterval(function() {
                var el = $('.navbar__basket--time');
                var content = el.text().split(':');
                var timeMins = parseInt(content[0]);
                var timeSec = parseInt(content[1]);
                if(timeMins === 0){
                    el.text('');
                    $('.navbar__basket').hide();
                } else {
                    if(timeSec === 0){
                        timeMins--;
                        timeSec = 60;
                    } else {
                        timeSec--;
                    }
                    el.text(timeMins + ':' + timeSec);
                }

            },1000);
        }
    } else {
       clearInterval(interval);
       $('.navbar__basket--time').text('');
       $('.navbar__basket').hide();
    }
}
$(document).ready(function(){
      $('[datetime-picker]').datetimepicker();
      checkCookie();
       });
</script>

</body>
</html>
